<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Test0">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="test0VO" type="ggsc.test0.service.Test0VO"/>
	
	
	<!-- 목록 -->
	<select id="test0Dao.getTest0List" parameterClass="test0VO" resultClass="egovMap">
		SELECT
			A.*
		FROM (
			SELECT
				ROW_NUMBER() OVER(ORDER BY H.YSM_HCLASS_CD , M.YSM_MCLASS_CD) AS RNUM ,
				H.YSM_HCLASS_CD ,
				H.YSM_HCLASS_NM ,
				M.YSM_MCLASS_CD ,
				M.YSM_MCLASS_NM
			FROM
				YSM_H_CLASS AS H
			INNER JOIN YSM_M_CLASS AS M
				ON H.YSM_HCLASS_CD = M.YSM_HCLASS_CD

			WHERE 1=1
			
			) A
			
		<![CDATA[
 		   	WHERE RNUM > #firstIndex# AND RNUM <= #lastIndex#
 		]]>
			
	</select>
	
	
	<!-- 개수 -->
	<select id="test0Dao.getTest0ListTotCnt" parameterClass="test0VO" resultClass="Integer">
		SELECT
			COUNT(*)
		FROM
			YSM_H_CLASS AS H
		INNER JOIN YSM_M_CLASS AS M
			ON H.YSM_HCLASS_CD = M.YSM_HCLASS_CD 
		WHERE
		    1=1
	</select>
	
	
	<select id="test0Dao.getClassTest" parameterClass="test0VO" resultClass="java.lang.Integer">
	
		<isEqual property="firstIndex" compareValue="1">
			SELECT COUNT(*) FROM YSM_H_CLASS WHERE YSM_HCLASS_NM = #schYsmHclassNm#
		</isEqual>
		<isEqual property="firstIndex" compareValue="2">
			SELECT COUNT(*) FROM YSM_H_CLASS AS A
				INNER JOIN YSM_M_CLASS AS B ON A.YSM_HCLASS_CD = B.YSM_HCLASS_CD
				AND A.YSM_HCLASS_CD = #schYsmHclassCd# AND YSM_MCLASS_NM = #schYsmMclassNm#
		</isEqual>
	</select>
	
	
	<select id="test0Dao.getTest0HList" parameterClass="Test0VO" resultClass="egovMap">
		SELECT
			YSM_HCLASS_CD ,
			YSM_HCLASS_NM ,
			ODR
		FROM
			YSM_H_CLASS	
		WHERE
			1=1
		<isNotEmpty property="schYsmHclassNm">
			AND YSM_HCLASS_NM LIKE CONCAT('%' , #schYsmHclassNm#, '%')
		</isNotEmpty>
	</select>
	
	
	<select id ="test0Dao.getTest0MList" parameterClass="Test0VO" resultClass="egovMap">
		SELECT
			M.YSM_MCLASS_CD,
			M.YSM_MCLASS_NM,
			M.ODR ,
			H.YSM_HCLASS_CD
		FROM 
			YSM_H_CLASS AS H
		INNER JOIN YSM_M_CLASS AS M
			ON H.YSM_HCLASS_CD = M.YSM_HCLASS_CD
		WHERE 
			H.YSM_HCLASS_CD = #ysmHclassCd#
			ORDER BY M.YSM_MCLASS_CD ASC
	</select>
	
	
	<insert id="test0Dao.insertYsmHcd" parameterClass="test0VO">
		INSERT INTO YSM_H_CLASS (
			YSM_HCLASS_CD ,
			YSM_HCLASS_NM ,
			ODR ,
			REG_ID 
		) values (
			(SELECT CONCAT('G', LPAD(COUNT(YSM_HCLASS_CD)+1 , 2, '0')) FROM YSM_H_CLASS AS A) ,
			#ysmHclassNm# ,
			1 ,
			#regId# 
		)
		
	</insert>
	
	
	<insert id="test0Dao.insertYsmMcd" parameterClass="test0VO">
		INSERT INTO YSM_M_CLASS (
			YSM_MCLASS_CD,
			YSM_HCLASS_CD,
			YSM_MCLASS_NM,
			ODR ,
			REG_ID
		) values (
			(SELECT CONCAT(#ysmHclassCd#, LPAD(COUNT(M.YSM_MCLASS_CD)+1 , 3, '0')) FROM YSM_M_CLASS AS M WHERE M.YSM_HCLASS_CD = #ysmHclassCd#) ,
			#ysmHclassCd# ,
			#ysmMclassNm# ,
			(SELECT IFNULL(MAX(M.ODR),0)+1 FROM YSM_H_CLASS AS H INNER JOIN YSM_M_CLASS AS M ON H.YSM_HCLASS_CD = M.YSM_HCLASS_CD WHERE H.YSM_HCLASS_CD = #ysmHclassCd#) ,
			'admin'
		)
	</insert>
	
	
</sqlMap>